<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" type="text/css" href="index.css"> 
<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script type="text/javascript"
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAro7nL7uI5ShTXZ4MKJNruNMt8I67EXv4&sensor=true">
</script>
<script type="text/javascript">
function initialize() {
    var mapOptions = {
        center: new google.maps.LatLng(33.648192,-117.842339),
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.HYBRID
    };
    var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);

    var dbh = new google.maps.LatLng(33.64337,-117.841974);
    var marker = new google.maps.Marker({
                position: dbh ,
                title:"DBH"
               });

    var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<h1 id="firstHeading" class="firstHeading">Donald Bren Hall</h1>'+
      '<div id="bodyContent">'+
      '<p><b>DBH</b>, also referred to as <b>Ayers Rock</b>,'+ 
      'Aboriginal people of the area. It has many springs, waterholes, '+
      'rock caves and ancient paintings. Uluru is listed as a World '+
      'Heritage Site.</p>'+
      '<p> '+
      '(last visited June 22, 2009).</p>'+
      '</div>'+
      '</div>';

    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    var geocoder = new google.maps.Geocoder();
    function codeAddress(address) {
        geocoder.geocode( { 'address': address}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                console.log( results[0].geometry.location);
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
        
    }

    codeAddress('Donald Bren Hall');

    google.maps.event.addListener(marker, 'click', function() {
    infowindow.open(map,marker);
    });

    // To add the marker to the map, call setMap();
    marker.setMap(map);
}
function loadBuildingList(){ 
    // var ws = new WebSocket('ws://' + window.location.host + '/client');
    // ws.onopen = function() {
    //    ws.send("Hello, world");
    // };
    // ws.onmessage = function (evt) {
    //    alert(evt.data);
    // };   
    $.ajax({
            //url: "http://localhost:19101/query?query=use%20dataverse%20UCINow;%0Afor%20$l%20in%20dataset(%22UCILocation%22)%20return%20$l;",
            url: "http://tomato.ics.uci.edu:3000",
            type:"GET",
            dataType:"json",
            data:"",
            complete:function(resp){ 
                                
                var txt = resp.responseText;
                //json format
                var json = $.parseJSON(txt);
                                
                //jquery dom model processing
                var items = json.results[0];
                console.log(items[0])
                console.log(eval('('+items[0]+')').fullname)
                var $template = $("#template");
                for(var i = 0;i<items.length;i++){
                    var $tr = $template.find("tr[id='tempRow']").clone();
                    $tr.get(0).id="t" + i;
                    var x = eval('(' + items[i] + ')');
                    $tr.find(".buildid").html(x.buildid);
                    $tr.find(".fullname").html(x.fullname);
                    $tr.find(".abbr").html(x.abbr);
                    $template.append($tr);
                }
                $template.show();
            }
        })
}
google.maps.event.addDomListener(window, 'load', initialize);
loadBuildingList()
</script>
</head>
<body>
<div id="layout">
    <div id="top">
        <div id="inputBox">
            <table>
            <tbody>
                <tr>
                    <td>
                        <img id="logoImg" src="ic_launcher.png">
                    </td>
                    <td>
                        <input id="searchText" value="multimedia">
                    </td>
                </tr>
            </tbody>
            </table>
        </div>
    </div>
    <div id="left">
        <div id="listView">
            <div id="resultContainer"  style='overflow: auto;'>
                <table id="template" style="display:none">
                    <tr id="tempRow" class="location">
                        <td class="buildid"></td>
                        <td class="fullname"></td>
                        <td class="abbr"></td>
                        <td class="ucimap"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id="center">
        <div id="map-canvas">
        </div>
    </div>
</div>
</body>
</html>

